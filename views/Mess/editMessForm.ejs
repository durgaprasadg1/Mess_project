<div
  id="loader"
  class="d-flex justify-content-center align-items-center"
  style="
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: white;
    z-index: 9999;
    opacity: 1;
  "
>
  <div class="spinner-grow text-primary" role="status">
    <span class="visually-hidden">Loading...</span>
  </div>
</div>
<%- layout("/layouts/boilerplate") %>

<div class="container my-5">
  <div class="row justify-content-center">
    <div class="col-12 col-md-8 col-lg-6">
      <div class="card shadow-lg border-0 rounded-3">
        <div class="card-body p-4">
          <h3 class="text-center mb-4">Add New Mess</h3>

          <form
            method="POST"
            action="/mess/<%= mess._id %>/edit?_method=PUT"
            enctype="multipart/form-data"
            novalidate
            class="needs-validation"
          >
            <div class="mb-3">
              <label for="name" class="form-label fw-semibold">Mess Name</label>
              <input
                type="text"
                id="name"
                name="name"
                value="<%= mess.name %>"
                class="form-control"
                placeholder="Kakunchi Mess"
                required
              />
              <div class="invalid-feedback">Give a sophisticated name</div>
            </div>

            <div class="mb-3">
              <label for="tagline" class="form-label fw-semibold"
                >Tag Line</label
              >
              <input
                type="text"
                id="tagline"
                name="description"
                class="form-control"
                placeholder="Bin Khaye Raha Naa Jaaye"
                value="<%= mess.description %>"
              />
            </div>

            <div class="mb-3">
              <label for="address" class="form-label fw-semibold"
                >Address</label
              >
              <input
                type="text"
                id="address"
                name="address"
                value="<%= mess.address %>"
                class="form-control"
                placeholder="Give Full Address"
                required
              />
              <div class="invalid-feedback">Add Address</div>
            </div>

            <div class="mb-3">
              <label for="category" class="form-label fw-semibold"
                >Category :</label
              >
              <input
                type="text"
                id="category"
                name="category"
                value="<%= mess.category %>"
                class="form-control"
                placeholder="Veg / Non-Veg / Both"
                required
              />
              <div class="invalid-feedback">Give a sophisticated name</div>
            </div>
            
            <div class="mb-3 row">
              <div class="col-md-6">
                <label for="mealTime" class="form-label fw-semibold">Meal Time</label>
                <select id="mealTime" name="mealTime" class="form-select">
                  <option value="" <%= !mess.mealTime ? 'selected' : '' %>>Select</option>
                  <option value="lunch" <%= mess.mealTime === 'lunch' ? 'selected' : '' %>>Lunch</option>
                  <option value="dinner" <%= mess.mealTime === 'dinner' ? 'selected' : '' %>>Dinner</option>
                </select>
              </div>
              <div class="col-md-6">
                <label for="isLimited" class="form-label fw-semibold">Limited Plates</label>
                <div class="form-check form-switch mt-2">
                  <input class="form-check-input" type="checkbox" id="isLimited" name="isLimited" <%= mess.isLimited ? 'checked' : '' %> />
                  <label class="form-check-label" for="isLimited"><%= mess.isLimited ? 'Yes' : 'No' %></label>
                </div>
              </div>
            </div>

            <div class="mb-3 row">
              <div class="col-md-6">
                <label for="vegPrice" class="form-label fw-semibold">Veg Plate Price (₹)</label>
                <input type="number" step="0.01" id="vegPrice" name="vegPrice" class="form-control" value="<%= typeof mess.vegPrice !== 'undefined' && mess.vegPrice !== null ? mess.vegPrice : '' %>" />
              </div>
              <div class="col-md-6">
                <label for="nonVegPrice" class="form-label fw-semibold">Non-Veg Plate Price (₹)</label>
                <input type="number" step="0.01" id="nonVegPrice" name="nonVegPrice" class="form-control" value="<%= typeof mess.nonVegPrice !== 'undefined' && mess.nonVegPrice !== null ? mess.nonVegPrice : '' %>" />
              </div>
            </div>

            <hr />

            <div class="mb-3">
              <label for="ownerName" class="form-label fw-semibold">Owner Name</label>
              <input type="text" id="ownerName" name="ownerName" value="<%= mess.ownerName %>" class="form-control" required />
              <div class="invalid-feedback">Owner name is required</div>
            </div>

            <div class="mb-3 row">
              <div class="col-md-6">
                <label for="adharNumber" class="form-label fw-semibold">Aadhar Number</label>
                <input type="text" id="adharNumber" name="adharNumber" value="<%= mess.adharNumber %>" class="form-control" pattern="\d{12}" required />
                <div class="invalid-feedback">Aadhar must be 12 digits</div>
              </div>
              <div class="col-md-6">
                <label for="phoneNumber" class="form-label fw-semibold">Phone Number</label>
                <input type="tel" id="phoneNumber" name="phoneNumber" value="<%= mess.phoneNumber %>" class="form-control" pattern="\d{10}" required />
                <div class="invalid-feedback">Phone must be 10 digits</div>
              </div>
            </div>

            <div class="mb-3 row">
              <div class="col-md-6">
                <label for="lat" class="form-label fw-semibold">Latitude</label>
                <input type="number" step="0.000001" id="lat" name="lat" value="<%= mess.lat %>" class="form-control" required />
                <div class="invalid-feedback">Latitude required</div>
              </div>
              <div class="col-md-6">
                <label for="lon" class="form-label fw-semibold">Longitude</label>
                <input type="number" step="0.000001" id="lon" name="lon" value="<%= mess.lon %>" class="form-control" required />
                <div class="invalid-feedback">Longitude required</div>
              </div>
            </div>

            <div class="mb-3">
              <label for="image" class="form-label fw-semibold"
                >Mess Banner</label
              >
              <input type="file" id="image" name="image" class="form-control" />
              <% if (mess.image && mess.image.url) { %>
              <img
                src="<%= mess.image.url %>"
                alt="Current banner"
                class="img-fluid mt-2 rounded"
              />
              <% } %>
              <div class="invalid-feedback">
                Only .jpg, .jpeg, .png formats are allowed
              </div>
            </div>

            <div class="d-grid">
              <button type="submit" class="btn btn-primary btn-lg">
                Update Mess
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
   window.addEventListener("load", function () {
    const loader = document.getElementById("loader");
    loader.style.transition = "opacity 0.5s ease";
    loader.style.opacity = "0";
    loader.style.zIndex = -99;
    setTimeout(() => loader.style.display = "none", 500);
  });
</script>
