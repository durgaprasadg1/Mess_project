<nav class="navbar navbar-expand-md navbar-light bg-white sticky-top border-bottom shadow-sm py-2">
  <div class="container">
    <a class="navbar-brand fw-bold fs-4 text-primary d-flex align-items-center me-auto text-decoration-none" href="/mess" style="letter-spacing: 0.5px;">
      <i class="fa-solid fa-utensils me-2" style="color: #ffc107; font-size: 1.4rem;"></i> MyMess
    </a>

    <button
      class="navbar-toggler"
      type="button"
      data-bs-toggle="collapse"
      data-bs-target="#messNavbar"
      aria-controls="messNavbar"
      aria-expanded="false"
      aria-label="Toggle navigation"
    >
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="messNavbar">
      <ul class="navbar-nav me-auto ms-md-4">
        <li class="nav-item">
          <a class="nav-link text-secondary fw-medium p-2 mx-1 rounded-pill" href="/mess">Home</a>
        </li>
        <% if(currentUser){ %>
        <li class="nav-item">
          <a class="nav-link text-secondary fw-medium p-2 mx-1 rounded-pill" href="/mess/new">Add Your Mess</a>
        </li>
        <% if(currentUser && noOfMess > 0){ %>
        <li class="nav-item">
          <a class="nav-link text-secondary fw-medium p-2 mx-1 rounded-pill" href="/mess/<%= currentUser.mess[0] %>/orders">Orders</a>
        </li>
        <% } %>
        <li class="nav-item">
          <a class="nav-link text-secondary fw-medium p-2 mx-1 rounded-pill" href="/consumer/<%= currentUser._id %>/History">History</a>
        </li>
        <% } %>
      </ul>

      <form class="d-flex my-2 my-md-0 mx-3" method="get" action="/mess/search">
        <div class="d-flex align-items-center bg-light rounded-pill border py-1 ps-3 shadow-sm">
          <input type="search" name="search" placeholder="Search Mess..." id="search-input" class="form-control-plaintext p-0" style="width: 200px;" />
          <button class="btn btn-link text-primary fs-5 p-0 me-2" type="submit">
            <i class="fa-solid fa-magnifying-glass"></i>
          </button>
        </div>
      </form>

      <ul class="navbar-nav">
        <% if(currentUser){ %>
        <div class="d-flex align-items-center bg-light p-2 rounded-pill mx-2 my-2 my-md-0 shadow-sm" id="profile" data-consumer-id="<%= currentUser._id %>">
            <i class="fa-solid fa-user me-2 text-primary"></i>
            <h6 class="m-0 fs-6 fw-semibold text-dark"><%= currentUser.username %></h6>
          </div>

          <div id="profile-info" 
            style="display:none; position:absolute; min-width:220px; z-index:1000;"
            class="bg-white border p-3 rounded shadow-lg">
          </div>

        <li class="nav-item d-flex align-items-center">
          <a
            class="nav-link btn btn-outline-danger px-3 py-1 ms-2"
            href="/login/logout"
            >Log Out</a
          >
        </li>
        <% } else { %>
        <li class="nav-item">
          <a class="nav-link" href="/signup">Sign Up</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/login">Login</a>
        </li>
        <% } %>
      </ul>
    </div>
  </div>
</nav>

<script>
// The original JavaScript is kept as is. The hover logic for showing/hiding the profile info is retained.
document.addEventListener("DOMContentLoaded", () => {
  const profile = document.getElementById("profile");
  const infoDiv = document.getElementById("profile-info");

  profile.addEventListener("mouseenter", async (e) => {
    const consumerId = profile.getAttribute("data-consumer-id");
    console.log(consumerId);
    try {
      const res = await fetch(`/consumer/${consumerId}/info`);
      const data = await res.json();

      if (data.error) {
        infoDiv.innerHTML = `<p class="text-danger">${data.error}</p>`;
      } else {
        infoDiv.innerHTML = `
          <h5 class="fw-bold mb-2">${data.username}</h5>
          <p class="mb-1"><b>Email:</b> ${data.email}</p>
          <p class="mb-1"><b>Phone:</b> ${data.phone}</p>
          <p class="mb-1"><b>Messes:</b> ${data.mess?.length || 0}</p>
          <p class="mb-1"><b>Orders:</b> ${data.orders?.length || 0}</p>
          <p class="mb-1"><b>Reviews:</b> ${data.reviews?.length || 0}</p>
        `;
      }

      const rect = profile.getBoundingClientRect();
      // Positioning is kept in JavaScript, relative to the profile element
      infoDiv.style.top = rect.bottom + 10 + "px";
      infoDiv.style.left = rect.left + "px";
      infoDiv.style.display = "block";
    } catch (err) {
      infoDiv.innerHTML = "<p class='text-danger'>Error fetching consumer info</p>";
      infoDiv.style.display = "block";
    }
  });

  profile.addEventListener("mouseleave", () => {
    infoDiv.style.display = "none";
  });
});
</script>