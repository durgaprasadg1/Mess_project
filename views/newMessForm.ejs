<%- layout("/layouts/boilerplate") %>

<!-- Loader -->
<div id="loader" class="d-flex justify-content-center align-items-center" 
  style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
         background: #fff7e6; z-index: 9999; opacity: 1;">
  <div class="spinner-grow text-warning" role="status">
    <span class="visually-hidden">Loading...</span>
  </div>
</div>

<style>
  :root {
    --primary-color: #ff8c00;
    --secondary-color: #ffa726;
    --light-bg: #fff7e6;
    --dark-text: #4d2600;
  }

  body {
    background-color: var(--light-bg);
    font-family: 'Poppins', sans-serif;
  }

  .card {
    border: none;
    border-radius: 1.2rem;
    box-shadow: 0 1rem 2rem rgba(0, 0, 0, 0.1);
    background: #fff;
  }

  h3 {
    color: var(--primary-color);
    font-weight: 700;
  }

  small {
    display: block;
    background: #fff3cd;
    border-left: 4px solid var(--primary-color);
    padding: 0.6rem 1rem;
    border-radius: 6px;
    font-size: 0.9rem;
    margin-bottom: 1rem;
  }

  label {
    color: var(--dark-text);
  }

  .form-control, select {
    border-radius: 0.6rem;
    border: 1px solid #ffc107;
    transition: all 0.3s ease;
  }

  .form-control:focus, select:focus {
    border-color: var(--primary-color);
    box-shadow: 0 0 8px rgba(255, 140, 0, 0.3);
  }

  select {
    padding: 0.6rem;
    width: 100%;
    margin-top: 0.3rem;
  }

  .btn-primary {
    background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
    border: none;
    border-radius: 50px;
    font-weight: 600;
    transition: all 0.3s ease;
  }

  .btn-primary:hover {
    transform: scale(1.05);
    box-shadow: 0 0.8rem 1.5rem rgba(255, 140, 0, 0.3);
  }

  .invalid-feedback {
    font-size: 0.85rem;
    color: #e74c3c;
  }
</style>

<div class="container my-5">
  <div class="row justify-content-center">
    <div class="col-12 col-md-8 col-lg-6">
      <div class="card shadow-lg border-0 rounded-4 p-4">
        <div class="card-body">
          <h3 class="text-center mb-3">
            <i class="bi bi-shop-window me-2"></i> Add New Mess
          </h3>

          <small>üìç Please add this mess when you are near it ‚Äî 
            your current location will be automatically detected.
          </small>

          <form method="post" action="/mess/new" enctype="multipart/form-data" 
                novalidate class="needs-validation">

            <div class="mb-3">
              <label for="name" class="form-label fw-semibold">Mess Name</label>
              <input type="text" id="name" name="name" class="form-control"
                     placeholder="e.g., Kakunchi Mess" required>
              <div class="invalid-feedback">Give a sophisticated name.</div>
            </div>

            <div class="mb-3">
              <label for="tagline" class="form-label fw-semibold">Tagline</label>
              <input type="text" id="tagline" name="description" class="form-control"
                     placeholder="Bin Khaye Raha Naa Jaaye">
            </div>

            <div class="mb-3">
              <label for="address" class="form-label fw-semibold">Address</label>
              <input type="text" id="address" name="address" class="form-control"
                     placeholder="Give Proper Address" required>
              <div class="invalid-feedback">Add a proper address.</div>
            </div>

            <div class="mb-3">
              <label for="category" class="form-label fw-semibold">Category</label>
              <select name="category" id="category" required>
                <option value="">Select Category</option>
                <option value="veg">Veg</option>
                <option value="nonveg">Non-Veg</option>
                <option value="both">Both (Veg + Non-Veg)</option>
              </select>
            </div>

            <div class="mb-3">
              <label for="ownerName" class="form-label fw-semibold">Owner Name</label>
              <input type="text" id="ownerName" name="ownerName" class="form-control"
                     placeholder="Rajpal Yadav" minlength="3" required>
              <div class="invalid-feedback">Invalid Name</div>
            </div>

            <div class="mb-3">
              <label for="adharNumber" class="form-label fw-semibold">Aadhaar Number</label>
              <input type="text" id="adharNumber" name="adharNumber" class="form-control"
                     placeholder="0000 0000 0000" pattern="\d{12}" required>
              <div class="invalid-feedback">Invalid Aadhaar Number</div>
            </div>

            <!-- Phone -->
            <div class="mb-3">
              <label for="phoneNumber" class="form-label fw-semibold">Phone Number</label>
              <input type="tel" id="phoneNumber" name="phoneNumber" class="form-control"
                     placeholder="9999999999" pattern="\d{10}" required>
              <div class="invalid-feedback">Invalid Phone Number</div>
            </div>

            <input type="hidden" id="lat" name="lat">
            <input type="hidden" id="lon" name="lon">

            <div class="mb-4">
              <label for="image" class="form-label fw-semibold">Mess Banner</label>
              <input type="file" id="image" name="image" accept=".jpg,.jpeg,.png"
                     class="form-control" required>
              <div class="invalid-feedback">Only .jpg, .jpeg, .png formats are allowed</div>
            </div>

            <div class="d-grid">
              <button type="submit" class="btn btn-primary btn-lg">
                <i class="bi bi-plus-circle me-2"></i> Add Mess
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  window.addEventListener("load", function () {
    const loader = document.getElementById("loader");
    loader.style.transition = "opacity 0.5s ease";
    loader.style.opacity = "0";
    loader.style.zIndex = -99;
    setTimeout(() => loader.style.display = "none", 500);
  });

  navigator.geolocation.getCurrentPosition(
    (pos) => {
      document.getElementById("lat").value = pos.coords.latitude;
      document.getElementById("lon").value = pos.coords.longitude;
    },
    (err) => {
      console.error(err);
      alert("Unable to fetch location. Please allow location access.");
    }
  );
</script>
